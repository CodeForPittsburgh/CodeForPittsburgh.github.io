{"version":3,"file":"bootstrap-geocoder.js","sources":["../src/GeosearchInput.js"],"sourcesContent":["import { DomUtil, DomEvent, Util, Layer } from 'leaflet';\nimport { Util as EsriUtil } from 'esri-leaflet';\nimport { geosearchCore, arcgisOnlineProvider } from 'esri-leaflet-geocoder';\n\nexport var Search = Layer.extend({\n  options: {\n    allowMultipleResults: true,\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search',\n    wrapperStyle: 'input-group',\n    suggestionGroupStyle: 'dropdown-menu',\n    selectedStyle: 'geocoder-control-selected'\n  },\n\n  initialize: function (options) {\n    // this demo only supports one provider\n    if (!options.providers) {\n      options.providers = [ arcgisOnlineProvider() ];\n    }\n\n    Util.setOptions(this, options);\n\n    // instantiate the underlying class and pass along options\n    this._geosearchCore = geosearchCore(this, options);\n    this._geosearchCore.addEventParent(this);\n\n    this._geosearchCore._pendingSuggestions = [];\n\n    // bubble provider events up to the control\n    this._geosearchCore._providers[0].addEventParent(this);\n  },\n\n  _renderSuggestions: function (suggestions) {\n    var nodes = [];\n    var list;\n    var header;\n\n    var currentGroup;\n    this._suggestions.style.display = 'block';\n\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n\n      if (!list) {\n        list = DomUtil.create('ul', null, suggestion.provider._contentsElement);\n        list.style.display = 'block';\n      }\n\n      var suggestionItem = DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem['data-magic-key'] = suggestion.magicKey;\n    }\n\n    nodes.push(list);\n\n    return nodes;\n  },\n\n  clear: function () {\n    this._clearAllSuggestions();\n  },\n\n  _clearAllSuggestions: function () {\n    this._suggestions.style.display = 'none';\n\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this._clearProviderSuggestions(this.options.providers[i]);\n    }\n  },\n\n  _clearProviderSuggestions: function (provider) {\n    provider._contentsElement.innerHTML = '';\n  },\n\n  _finalizeSuggestions: function (activeRequests, suggestionsLength) {\n    // check if all requests are finished to remove the loading indicator\n    if (!activeRequests) {\n      DomUtil.removeClass(this._input, 'geocoder-control-loading');\n\n      // also check if there were 0 total suggest results to clear the parent suggestions element\n      // otherwise its display value may be \"block\" instead of \"none\"\n      if (!suggestionsLength) {\n        this._clearAllSuggestions();\n      }\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    EsriUtil.setEsriAttribution(map);\n\n    this._input = document.getElementById(this.options.inputTag);\n\n    // create a wrapper div around the input\n    this._wrapper = document.createElement('div');\n\n    DomUtil.addClass(this._wrapper, this.options.wrapperStyle);\n\n    this._input.parentNode.insertBefore(this._wrapper, this._input);\n    this._wrapper.appendChild(this._input);\n\n    this._input.title = this.options.title;\n\n    // create dom node for suggestions and place it below the input\n    this._suggestions = document.createElement('div');\n    DomUtil.addClass(this._suggestions, this.options.suggestionGroupStyle);\n\n    // create a child contents container element for each provider inside of this._suggestions\n    // to maintain the configured order of providers for suggested results\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this.options.providers[i]._contentsElement = DomUtil.create('div', null, this._suggestions);\n    }\n\n    this._input.parentNode.insertBefore(this._suggestions, null);\n\n    DomEvent.addListener(this._input, 'focus', function (e) {\n      this._input.placeholder = this.options.placeholder;\n    }, this);\n\n    DomEvent.addListener(this._suggestions, 'mousedown', function (e) {\n      var suggestionItem = e.target || e.srcElement;\n      this._geosearchCore._geocode(suggestionItem.innerHTML, suggestionItem['data-magic-key'], suggestionItem.provider);\n      this.clear();\n    }, this);\n\n    DomEvent.addListener(this._input, 'blur', function (e) {\n      this._input.placeholder = '';\n      this.clear();\n    }, this);\n\n    DomEvent.addListener(this._input, 'keydown', function (e) {\n      var selectedStyle = this.options.selectedStyle;\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + selectedStyle)[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if (list[i] === selected) {\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch (e.keyCode) {\n        case 13:  // enter\n          if (selected) {\n            this._geosearchCore._geocode(selected.innerText, selected['data-magic-key'], selected.provider);\n            this.clear();\n          } else if (this.options.allowMultipleResults) {\n            this._geosearchCore._geocode(this._input.value, undefined);\n            this.clear();\n          } else {\n            DomUtil.addClass(list[0], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 38: // up arrow\n          if (selected) {\n            L.DomUtil.removeClass(selected, selectedStyle);\n          }\n\n          var previousItem = list[selectedPosition - 1];\n\n          if (selected && previousItem) {\n            DomUtil.addClass(previousItem, selectedStyle);\n          } else {\n            DomUtil.addClass(list[list.length - 1], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 40: // down arrow\n          if (selected) {\n            DomUtil.removeClass(selected, selectedStyle);\n          }\n\n          var nextItem = list[selectedPosition + 1];\n\n          if (selected && nextItem) {\n            DomUtil.addClass(nextItem, selectedStyle);\n          } else {\n            DomUtil.addClass(list[0], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        default:\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\n            var request = this._geosearchCore._pendingSuggestions[x];\n            if (request && request.abort && !request.id) {\n              request.abort();\n            }\n          }\n          break;\n      }\n    }, this);\n\n    DomEvent.addListener(this._input, 'keyup', Util.throttle(function (e) {\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if (text.length < 2) {\n        this._lastValue = this._input.value;\n        this._clearAllSuggestions();\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if (key === 27) {\n        this._clearAllSuggestions();\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if (key !== 13 && key !== 38 && key !== 40) {\n        if (this._input.value !== this._lastValue) {\n          this._lastValue = this._input.value;\n          this._geosearchCore._suggest(text);\n        }\n      }\n    }, 50, this), this);\n  }\n});\n\nexport function search (options) {\n  return new Search(options);\n}\n"],"names":["Search","Layer","extend","options","allowMultipleResults","placeholder","title","wrapperStyle","suggestionGroupStyle","selectedStyle","initialize","providers","arcgisOnlineProvider","Util","setOptions","this","_geosearchCore","geosearchCore","addEventParent","_pendingSuggestions","_providers","_renderSuggestions","suggestions","list","nodes","_suggestions","style","display","i","length","suggestion","DomUtil","create","provider","_contentsElement","suggestionItem","innerHTML","text","magicKey","push","clear","_clearAllSuggestions","_clearProviderSuggestions","_finalizeSuggestions","activeRequests","suggestionsLength","removeClass","_input","onAdd","map","_map","EsriUtil","setEsriAttribution","document","getElementById","inputTag","_wrapper","createElement","addClass","parentNode","insertBefore","appendChild","DomEvent","addListener","e","target","srcElement","_geocode","selectedPosition","querySelectorAll","selected","keyCode","innerText","value","undefined","preventDefault","L","previousItem","nextItem","x","request","abort","id","throttle","key","which","_lastValue","_suggest"],"mappings":"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"}